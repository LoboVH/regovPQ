"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.basicMessageEvents = void 0;
const core_1 = require("@aries-framework/core");
const WebSocketEvents_1 = require("./WebSocketEvents");
const WebhookEvent_1 = require("./WebhookEvent");
const basicMessageEvents = async (agent, config) => {
    agent.events.on(core_1.BasicMessageEventTypes.BasicMessageStateChanged, async (event) => {
        const record = event.payload.basicMessageRecord;
        const body = record.toJSON();
        // Only send webhook if webhook url is configured
        if (config.webhookUrl) {
            await (0, WebhookEvent_1.sendWebhookEvent)(config.webhookUrl + '/basic-messages', body, agent.config.logger);
        }
        if (config.socketServer) {
            // Always emit websocket event to clients (could be 0)
            (0, WebSocketEvents_1.sendWebSocketEvent)(config.socketServer, Object.assign(Object.assign({}, event), { payload: {
                    message: event.payload.message.toJSON(),
                    basicMessageRecord: body,
                } }));
        }
    });
};
exports.basicMessageEvents = basicMessageEvents;
//# sourceMappingURL=BasicMessageEvents.js.map